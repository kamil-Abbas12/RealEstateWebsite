// pages/sitemap.xml.js
import { MongoClient } from "mongodb";
import blogs from "../data/blog";

export async function getServerSideProps({ res }) {
  const baseUrl = "https://evergreenestateglob.com";

  // Connect to MongoDB directly (replace with your connection string)
  const client = await MongoClient.connect(process.env.MONGODB_URI);
  const db = client.db("realestate");
  const properties = await db.collection("properties").find({}).toArray();
  client.close();

  const staticPages = [
    "",
    "/properties",
    "/blog",
    "/blog/grid",
    "/blog/list",
    "/search?listing_status=sale",
    "/search?listing_status=rent",
  ];

  let sitemap = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">`;

  // Add static pages
  staticPages.forEach((page) => {
    sitemap += `
  <url>
    <loc>${baseUrl}${page}</loc>
  </url>`;
  });

  // Add dynamic properties
  properties.forEach((property) => {
    sitemap += `
  <url>
    <loc>${baseUrl}/property/${property._id}</loc>
  </url>`;
  });

  // Add dynamic blogs
  blogs.forEach((blog) => {
    sitemap += `
  <url>
    <loc>${baseUrl}/blog/${blog.slug}</loc>
  </url>`;
  });

  sitemap += `
</urlset>`;

  res.setHeader("Content-Type", "text/xml");
  res.write(sitemap);
  res.end();

  return { props: {} };
}

export default function Sitemap() {
  return null;
}
